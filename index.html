<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>PFCバランス計算機 - 多言語対応</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    .container { background: #fff; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, select, button { width: 100%; padding: 10px; margin: 10px 0; font-size: 1em; }
    button { background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .result { background: #eaffea; border-left: 5px solid #4CAF50; padding: 15px; margin-top: 20px; border-radius: 5px; }
  </style>
</head>
<body>
  <div class="container" id="pdfArea">
    <label for="language"><strong>Language / 言語:</strong></label>
    <select id="language" onchange="changeLanguage()">
      <option value="ja">日本語</option>
      <option value="en">English</option>
    </select><br><br>

    <h1 id="title">PFCバランス計算機</h1>

    <label id="label-total">総摂取カロリー（kcal）</label>
    <input type="number" id="totalCal" placeholder="例: 2000">

    <label id="label-protein">タンパク質の割合（%）</label>
    <input type="number" id="protein" placeholder="例: 30">

    <label id="label-fat">脂質の割合（%）</label>
    <input type="number" id="fat" placeholder="例: 20">

    <label id="label-carb">炭水化物の割合（%）</label>
    <input type="number" id="carb" placeholder="例: 50">

    <label id="label-meals">1日の食事回数</label>
    <select id="meals">
      <option value="1">1回</option>
      <option value="2">2回</option>
      <option value="3" selected>3回</option>
      <option value="4">4回</option>
      <option value="5">5回</option>
      <option value="6">6回</option>
    </select>

    <button id="calcBtn" onclick="calculate()">計算する</button>
    <button onclick="downloadPDF()">PDFとして保存</button>

    <div class="result" id="result" style="display:none;"></div>
  </div>

  <!-- PDF出力ライブラリ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
const texts = {
  ja: {
    title: "PFCバランス計算機",
    label_total: "総摂取カロリー（kcal）",
    label_protein: "タンパク質の割合（%）",
    label_fat: "脂質の割合（%）",
    label_carb: "炭水化物の割合（%）",
    label_meals: "1日の食事回数",
    button: "計算する",
    result: {
      protein: "タンパク質",
      fat: "脂質",
      carb: "炭水化物"
    },
    alert: "すべての値を正しく入力してください",
    downloadAlert: "先に計算を行ってください"
  },
  en: {
    title: "PFC Macro Calculator",
    label_total: "Total Calorie Intake (kcal)",
    label_protein: "Protein Ratio (%)",
    label_fat: "Fat Ratio (%)",
    label_carb: "Carbohydrate Ratio (%)",
    label_meals: "Number of meals per day",
    button: "Calculate",
    result: {
      protein: "Protein",
      fat: "Fat",
      carb: "Carbohydrates"
    },
    alert: "Please enter all values correctly",
    downloadAlert: "Please calculate first before downloading"
  }
};

function changeLanguage() {
  const lang = document.getElementById("language").value;
  document.documentElement.lang = lang;
  document.getElementById("title").textContent = texts[lang].title;
  document.getElementById("label-total").textContent = texts[lang].label_total;
  document.getElementById("label-protein").textContent = texts[lang].label_protein;
  document.getElementById("label-fat").textContent = texts[lang].label_fat;
  document.getElementById("label-carb").textContent = texts[lang].label_carb;
  document.getElementById("label-meals").textContent = texts[lang].label_meals;
  document.getElementById("calcBtn").textContent = texts[lang].button;
}

function calculate() {
  const lang = document.getElementById("language").value;
  const totalCal = parseFloat(document.getElementById("totalCal").value);
  const proteinRatio = parseFloat(document.getElementById("protein").value);
  const fatRatio = parseFloat(document.getElementById("fat").value);
  const carbRatio = parseFloat(document.getElementById("carb").value);
  const meals = parseInt(document.getElementById("meals").value);

  if (isNaN(totalCal) || isNaN(proteinRatio) || isNaN(fatRatio) || isNaN(carbRatio) || isNaN(meals)) {
    alert(texts[lang].alert);
    return;
  }

  const pCal = totalCal * (proteinRatio / 100);
  const fCal = totalCal * (fatRatio / 100);
  const cCal = totalCal * (carbRatio / 100);

  const pGram = Math.round(pCal / 4);
  const fGram = Math.round(fCal / 9);
  const cGram = Math.round(cCal / 4);

  const pPerMeal = Math.round(pGram / meals);
  const fPerMeal = Math.round(fGram / meals);
  const cPerMeal = Math.round(cGram / meals);
  const calPerMeal = Math.round(totalCal / meals);

  const result = document.getElementById("result");
  result.innerHTML = `
    <h2>${lang === 'ja' ? "1日の食事の目安" : "Meal Plan for the Day"}</h2>
    <p><strong>${texts[lang].result.protein}:</strong> ${pGram} g (${Math.round(pCal)} kcal)</p>
    <p><strong>${texts[lang].result.fat}:</strong> ${fGram} g (${Math.round(fCal)} kcal)</p>
    <p><strong>${texts[lang].result.carb}:</strong> ${cGram} g (${Math.round(cCal)} kcal)</p>
    <hr>
    <p><strong>${meals} ${lang === 'ja' ? "回の食事の場合（1回あたり）" : "meals per day (per meal)"}:</strong></p>
    <p>${texts[lang].result.protein}: ${pPerMeal} g</p>
    <p>${texts[lang].result.fat}: ${fPerMeal} g</p>
    <p>${texts[lang].result.carb}: ${cPerMeal} g</p>
    <p>${lang === 'ja' ? "合計" : "Total"}: ${calPerMeal} kcal</p>
  `;
  result.style.display = "block";
}

function downloadPDF() {
  const lang = document.getElementById("language").value;
  const area = document.getElementById("pdfArea");

  const opt = {
    margin: 0.3,
    filename: lang === 'ja' ? 'PFC計算結果.pdf' : 'PFC_Macro_Result.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 3, useCORS: true },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().set(opt).from(area).save();
}

window.onload = changeLanguage;
</script>
</body>
</html>